{{define "content"}}
<div class="cti-knowledge-plane-box">       
   <div class="cti-knowledge-plane-box-header">
        <div class="plane-box-search">
            <div class="ui fluid action input">
                <input type="text" placeholder="IP、URL、HASH、CVE、 国家">
                <div class="ui primary button">查询</div>
            </div>
        </div>
   </div>
   <div class="cti-knowledge-plane-box-body">
        <div class="plane-box-body-nav">
            <a class="nav-item" href="/knowledge-plane?tab=normal">
                常规攻击(1209)
            </a>
            <a class="nav-item" href="/knowledge-plane?tab=traffic">
                流量攻击(123)
            </a>
            <a class="nav-item" href="/knowledge-plane?tab=feature">
                攻击特征(556)
            </a>
        </div>
        <div class="plane-box-body-box-1">
            <div class="body-box-1-top">
                <div class="top-left-box">
                    <div class="box-head">
                        IOC分布地图
                        <div class="box-head-toolbar head-toolbar-1">
                            <a class="ui small blue  label" data-tab="world">世界</a>
                            <a class="ui small label" data-tab="china">中国</a>
                        </div>
                    </div>
                    <div class="box-body">
                        <div id="ctiWorldMap"></div>
                    </div>
                </div>
                <div class="top-right-box">
                    <div class="box-head">
                        IOC类型分布
                        <div class="box-head-toolbar head-toolbar-2">
                            <a class="ui small blue  label" data-tab="ioc_type">IOC类型</a>
                            <a class="ui small label" data-tab="attack_type">攻击类型</a>
                        </div>
                    </div>
                    <div class="box-body">
                        <div id="typePieChart"></div>
                    </div>
                </div>
            </div>
            <div class="body-box-1-buttom">
                
            </div>
        </div>
        <div class="plane-box-body-box-2">

        </div>
   </div>
</div>
<script type="text/javascript" src="/static/map/world.js"></script>
<script type="text/javascript" src="/static/map/init_map.js"></script>
<script type="text/javascript" src="/static/front/js/init_kp_echart.js"></script>
<script>
$(document).ready(function() {
    // 为 '详情' 按钮绑定点击事件
    $('.cti-detail').click(function() {
        var ctiId = $(this).data('id');
        openCtiDetailWindow('/cti-market/detail?id=' + ctiId);
    });

    // 为 '获取' 按钮绑定点击事件
    $('.cti-detail-buy').click(function() {
        var ctiId = $(this).data('id');
        openCtiDetailWindow('/cti-market/detail?id=' + ctiId);
    });
    //tab激活
    var currentTab = getUrlQueryString("tab")
    if(currentTab){
        $(".nav-item[href='/knowledge-plane?tab="+currentTab+"']").addClass("nav-item-active")
    }else{
        //激活第一个tab
        $(".nav-item").first().addClass("nav-item-active")
    }
    //地图切换
    $('.head-toolbar-1 a').on('click', function() {
        // 移除所有 a 元素的 blue 类
        $('.head-toolbar-1 a').removeClass('blue');
        $('.head-toolbar-1 a').removeClass('red')
        var tabName = $(this).data("tab")
        console.log(tabName)
        if(tabName=="china")
            $(this).removeClass('grey').addClass('red');
        else
            $(this).removeClass('grey').addClass('blue');
    });
    //类型切换
    $('.head-toolbar-2 a').on('click', function() {
        // 移除所有 a 元素的 blue 类
        $('.head-toolbar-2 a').removeClass('blue');
        $('.head-toolbar-2 a').removeClass('red')
        var tabName = $(this).data("tab")
        console.log(tabName)
        if(tabName=="attack_type")
            $(this).removeClass('grey').addClass('red');
        else
            $(this).removeClass('grey').addClass('blue');
    });
});
var currentLayerIndex = null; //设置只可打开一个窗口
function openCtiDetailWindow(url) {
    if (currentLayerIndex !== null) {
        layer.close(currentLayerIndex);
    }
    currentLayerIndex = layer.open({
            type: 2,
            title: '详情',
            area: ['700px', '550px'], // 设置窗口宽度和高度
            shade: 0, // 设置遮罩透明度
            content: url,
            success: function(layero, index){
            }
    });
}
</script>
{{end}}
	
 
